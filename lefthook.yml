# Lefthook configuration - faster alternative to Husky + lint-staged
# https://github.com/evilmartians/lefthook

pre-commit:
  parallel: true
  commands:
    lint:
      glob: '*.{ts,tsx}'
      run: npx eslint --fix --no-warn-ignored {staged_files} && git add {staged_files}
      stage_fixed: true
    format-code:
      glob: '*.{ts,tsx}'
      run: npx prettier --write {staged_files}
      stage_fixed: true
    format-other:
      glob: '*.{json,md,yaml,yml}'
      run: npx prettier --write {staged_files}
      stage_fixed: true
    typecheck:
      run: npx tsc --noEmit
      skip:
        - merge
        - rebase

pre-push:
  commands:
    test:
      run: npx nx affected -t test --base=origin/main --head=HEAD
      skip:
        - merge
        - rebase

commit-msg:
  commands:
    conventional:
      # Validate conventional commit format
      run: |
        message=$(cat {1})
        if ! echo "$message" | grep -qE "^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\(.+\))?: .+"; then
          echo "Error: Commit message must follow Conventional Commits format"
          echo "Example: feat(auth): add login functionality"
          exit 1
        fi
